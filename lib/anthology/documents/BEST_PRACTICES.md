# Word 文档使用最佳实践

## 📋 工作流程

### 1. 准备 Word 文档

**文件命名规则：**
- 文件名 = 文章 ID（不含扩展名）
- 格式：`{文章ID}.docx`
- 示例：`buffett-letter-1980.docx`

**文档格式建议：**
- ✅ 使用 Word 的标题样式（"标题 1"、"标题 2" 等）
- ✅ 使用粗体、斜体等基本格式
- ✅ 使用列表（有序/无序）
- ❌ 避免复杂表格（可能转换不完美）
- ❌ 避免图片（需要单独处理）

### 2. 添加元数据

在 `lib/anthology/metadata.ts` 中添加文章信息：

```typescript
{
  name: "作者名称",
  categories: [
    {
      name: "分类名称",
      articles: [
        { id: "文章ID", title: "文章标题" }, // ID 必须与文件名一致
      ],
    },
  ],
}
```

**重要：**
- `id` 必须与 Word 文件名（不含 `.docx`）完全一致
- `title` 是显示在列表中的标题，可以与文件名不同

### 3. 放置文档

将 `.docx` 文件放到：
```
lib/anthology/documents/{文章ID}.docx
```

### 4. 重启服务器

修改后需要重启开发服务器才能看到更新。

## 🎯 标题层级建议

为了在右侧目录中正确显示，建议使用以下标题层级：

- **标题 1** (`#`) - 主要章节
- **标题 2** (`##`) - 二级章节
- **标题 3** (`###`) - 三级章节
- **标题 4-6** (`####`, `#####`, `######`) - 更细的层级

系统会自动识别并显示在右侧目录中。

## ⚡ 性能优化建议

### 1. 文档大小
- 单个文档建议 < 500KB
- 如果文档很大，考虑拆分为多篇文章

### 2. 缓存机制
- 文章内容会被缓存在内存中
- 首次访问会解析 Word 文档（稍慢）
- 后续访问直接从缓存读取（很快）

### 3. 更新内容
- 修改 Word 文档后，需要重启服务器才能看到更新
- 或者清除缓存（重启服务器）

## 📝 格式转换说明

Word 文档中的格式会自动转换：

| Word 格式 | Markdown | 说明 |
|----------|----------|------|
| 标题 1-6 | `#` - `######` | 自动识别并显示在目录 |
| **粗体** | `**粗体**` | ✅ 支持 |
| *斜体* | `*斜体*` | ✅ 支持 |
| 列表 | `- 列表项` | ✅ 支持 |
| 段落 | 普通文本 | ✅ 支持 |
| 表格 | 可能丢失 | ⚠️ 建议避免 |
| 图片 | 不支持 | ❌ 需要单独处理 |

## 🔍 故障排查

### 问题：文章加载失败

**检查清单：**
1. ✅ 文件是否存在：`lib/anthology/documents/{文章ID}.docx`
2. ✅ 文件名是否与文章 ID 完全一致（区分大小写）
3. ✅ `metadata.ts` 中是否添加了对应的文章元数据
4. ✅ `mammoth` 库是否已安装：`npm list mammoth`
5. ✅ 服务器是否已重启

### 问题：标题没有显示在目录中

**可能原因：**
1. Word 文档中没有使用标题样式
2. 标题样式名称不匹配（系统识别 "标题 1-6"、"Heading 1-6"）

**解决方案：**
- 在 Word 中使用标准的标题样式
- 或者手动设置文本为粗体，系统会尝试识别

### 问题：格式转换不正确

**说明：**
- mammoth 主要将 Word 转换为 HTML，然后简化为 Markdown
- 复杂格式可能不会完美转换
- 建议使用简单的文本格式

## 📚 示例

### 完整的文章添加流程

1. **创建 Word 文档**
   - 文件名：`my-new-article.docx`
   - 内容：使用标题样式编写文章

2. **放置文档**
   ```
   lib/anthology/documents/my-new-article.docx
   ```

3. **添加元数据**
   ```typescript
   // lib/anthology/metadata.ts
   {
     name: "作者名称",
     categories: [
       {
         name: "分类名称",
         articles: [
           { id: "my-new-article", title: "我的新文章" },
         ],
       },
     ],
   }
   ```

4. **重启服务器**
   ```bash
   npm run dev
   ```

5. **访问页面**
   - 打开 http://localhost:3002/anthology
   - 点击文章即可看到内容

## 💡 提示

- **批量添加**：可以一次性添加多个 Word 文档，然后在 `metadata.ts` 中批量添加元数据
- **版本控制**：Word 文档会被 Git 跟踪，建议定期提交
- **备份**：建议保留 Word 文档的备份
- **测试**：添加新文章后，先在本地测试，确认格式正确后再部署
